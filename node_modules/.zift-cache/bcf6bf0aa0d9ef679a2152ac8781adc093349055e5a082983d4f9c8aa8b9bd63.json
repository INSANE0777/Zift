{"facts":{"ENV_READ":[],"FILE_READ_SENSITIVE":[],"NETWORK_SINK":[],"DYNAMIC_EXECUTION":[],"OBFUSCATION":[],"FILE_WRITE_STARTUP":[],"SHELL_EXECUTION":[],"ENCODER_USE":[]},"flows":[{"fromVar":"require('acorn')","toVar":"acorn","file":"A:\\Package\\src\\collector.js","line":1},{"fromVar":"require('acorn-walk')","toVar":"walk","file":"A:\\Package\\src\\collector.js","line":2},{"fromVar":"code","toVar":"this.sourceCode","file":"A:\\Package\\src\\collector.js","line":25},{"fromVar":"calculateEntropy(node.value)","toVar":"entropy","file":"A:\\Package\\src\\collector.js","line":40},{"fromVar":"this.getSourceCode(node.callee)","toVar":"calleeCode","file":"A:\\Package\\src\\collector.js","line":52},{"fromVar":"this.getSourceCode(arg)","toVar":"argCode","file":"A:\\Package\\src\\collector.js","line":106},{"fromVar":"this.findFunctionDefinition(calleeCode, ancestors[0])","toVar":"funcNode","file":"A:\\Package\\src\\collector.js","line":109},{"fromVar":"funcNode.params[index].name","toVar":"paramName","file":"A:\\Package\\src\\collector.js","line":111},{"fromVar":"this.getSourceCode(node.object)","toVar":"objectCode","file":"A:\\Package\\src\\collector.js","line":123},{"fromVar":"node.property.name || (node.property.type === 'Literal' ? node.property.value : null)","toVar":"property","file":"A:\\Package\\src\\collector.js","line":125},{"fromVar":"['NODE_ENV', 'TIMING', 'DEBUG', 'VERBOSE', 'CI', 'APPDATA', 'HOME', 'USERPROFILE', 'PATH', 'PWD']","toVar":"whitelist","file":"A:\\Package\\src\\collector.js","line":126},{"fromVar":"this.getSourceCode(node.init)","toVar":"from","file":"A:\\Package\\src\\collector.js","line":138},{"fromVar":"this.getSourceCode(node.right)","toVar":"from","file":"A:\\Package\\src\\collector.js","line":149},{"fromVar":"this.getSourceCode(node.left)","toVar":"to","file":"A:\\Package\\src\\collector.js","line":150},{"fromVar":"ancestors[ancestors.length - 2]","toVar":"parent","file":"A:\\Package\\src\\collector.js","line":160},{"fromVar":"parent.id.name","toVar":"objName","file":"A:\\Package\\src\\collector.js","line":162},{"fromVar":"this.getSourceCode(prop.value)","toVar":"valCode","file":"A:\\Package\\src\\collector.js","line":165},{"fromVar":"[\r\n            'http.request', 'https.request', 'http.get', 'https.get',\r\n            'net.connect', 'dns.lookup', 'dns.resolve', 'dns.resolve4', 'dns.resolve6',\r\n            'fetch', 'axios', 'request'\r\n        ]","toVar":"methodSinks","file":"A:\\Package\\src\\collector.js","line":184},{"fromVar":"['child_process.exec', 'child_process.spawn', 'child_process.execSync', 'exec', 'spawn', 'execSync']","toVar":"shellSinks","file":"A:\\Package\\src\\collector.js","line":194},{"fromVar":"['Buffer.from', 'btoa', 'atob']","toVar":"encoders","file":"A:\\Package\\src\\collector.js","line":199},{"fromVar":"null","toVar":"found","file":"A:\\Package\\src\\collector.js","line":208},{"fromVar":"String(node.arguments[0].value)","toVar":"path","file":"A:\\Package\\src\\collector.js","line":227},{"fromVar":"['.ssh', '.env', 'shadow', 'passwd', 'credentials', 'token']","toVar":"sensitive","file":"A:\\Package\\src\\collector.js","line":228},{"fromVar":"ASTCollector","toVar":"module.exports","file":"A:\\Package\\src\\collector.js","line":239},{"fromVar":"[]","toVar":"findings","file":"A:\\Package\\src\\engine.js","line":9},{"fromVar":"this.matchRule(rule, packageFacts, lifecycleFiles)","toVar":"match","file":"A:\\Package\\src\\engine.js","line":13},{"fromVar":"[]","toVar":"triggers","file":"A:\\Package\\src\\engine.js","line":24},{"fromVar":"rule.baseScore","toVar":"baseScore","file":"A:\\Package\\src\\engine.js","line":25},{"fromVar":"1","toVar":"multiplier","file":"A:\\Package\\src\\engine.js","line":26},{"fromVar":"facts[req] || []","toVar":"matchedFacts","file":"A:\\Package\\src\\engine.js","line":30},{"fromVar":"facts[opt] || []","toVar":"matchedOpts","file":"A:\\Package\\src\\engine.js","line":46},{"fromVar":"triggers.some(t => lifecycleFiles.has(t.file))","toVar":"isInLifecycle","file":"A:\\Package\\src\\engine.js","line":55},{"fromVar":"facts['ENCODER_USE'] && facts['ENCODER_USE'].length > 0","toVar":"hasEncoder","file":"A:\\Package\\src\\engine.js","line":61},{"fromVar":"triggers.some(t => t.type.includes('READ'))","toVar":"hasSource","file":"A:\\Package\\src\\engine.js","line":67},{"fromVar":"triggers.some(t => t.type.includes('SINK') || t.type === 'DYNAMIC_EXECUTION' || t.type === 'SHELL_EXECUTION')","toVar":"hasSink","file":"A:\\Package\\src\\engine.js","line":68},{"fromVar":"baseScore * multiplier","toVar":"finalScore","file":"A:\\Package\\src\\engine.js","line":73},{"fromVar":"triggers.some(t => t.type === 'ENV_READ')","toVar":"isEnvRead","file":"A:\\Package\\src\\engine.js","line":76},{"fromVar":"triggers.some(t => t.type === 'NETWORK_SINK' || t.type === 'SHELL_EXECUTION')","toVar":"isDangerousSink","file":"A:\\Package\\src\\engine.js","line":77},{"fromVar":"SafetyEngine","toVar":"module.exports","file":"A:\\Package\\src\\engine.js","line":94},{"fromVar":"require('fs')","toVar":"fs","file":"A:\\Package\\src\\lifecycle.js","line":1},{"fromVar":"require('path')","toVar":"path","file":"A:\\Package\\src\\lifecycle.js","line":2},{"fromVar":"packageDir","toVar":"this.packageDir","file":"A:\\Package\\src\\lifecycle.js","line":6},{"fromVar":"path.join(this.packageDir, 'package.json')","toVar":"packageJsonPath","file":"A:\\Package\\src\\lifecycle.js","line":12},{"fromVar":"JSON.parse(fs.readFileSync(packageJsonPath, 'utf8'))","toVar":"pkg","file":"A:\\Package\\src\\lifecycle.js","line":16},{"fromVar":"pkg.scripts || {}","toVar":"scripts","file":"A:\\Package\\src\\lifecycle.js","line":17},{"fromVar":"['preinstall', 'postinstall', 'install', 'preuninstall', 'postuninstall']","toVar":"lifecycleHooks","file":"A:\\Package\\src\\lifecycle.js","line":19},{"fromVar":"script.match(/node\\s+([\\w\\.\\/\\-\\\\]+\\.js)/g)","toVar":"nodeMatch","file":"A:\\Package\\src\\lifecycle.js","line":36},{"fromVar":"match.replace(/node\\s+/, '').trim()","toVar":"filePath","file":"A:\\Package\\src\\lifecycle.js","line":39},{"fromVar":"script.match(/^([\\w\\.\\/\\-\\\\]+\\.js)(\\s|$)/)","toVar":"directMatch","file":"A:\\Package\\src\\lifecycle.js","line":45},{"fromVar":"LifecycleResolver","toVar":"module.exports","file":"A:\\Package\\src\\lifecycle.js","line":56},{"fromVar":"require('node:fs')","toVar":"fs","file":"A:\\Package\\src\\lockfile.js","line":1},{"fromVar":"require('node:path')","toVar":"path","file":"A:\\Package\\src\\lockfile.js","line":2},{"fromVar":"packageDir","toVar":"this.packageDir","file":"A:\\Package\\src\\lockfile.js","line":6},{"fromVar":"[\r\n            { name: 'package-lock.json', type: 'npm' },\r\n            { name: 'pnpm-lock.yaml', type: 'pnpm' },\r\n            { name: 'bun.lockb', type: 'bun' }\r\n        ]","toVar":"lockfiles","file":"A:\\Package\\src\\lockfile.js","line":11},{"fromVar":"path.join(this.packageDir, lock.name)","toVar":"fullPath","file":"A:\\Package\\src\\lockfile.js","line":18},{"fromVar":"fs.readFileSync(filePath, 'utf8')","toVar":"content","file":"A:\\Package\\src\\lockfile.js","line":28},{"fromVar":"JSON.parse(content)","toVar":"lock","file":"A:\\Package\\src\\lockfile.js","line":32},{"fromVar":"content.split('\\n')","toVar":"lines","file":"A:\\Package\\src\\lockfile.js","line":46},{"fromVar":"line.match(/(git\\+ssh|git\\+https|github:|[a-zA-Z0-9.\\-_]+\\/[a-zA-Z0-9.\\-_]+#[a-f0-9]+)/)","toVar":"gitMatch","file":"A:\\Package\\src\\lockfile.js","line":48},{"fromVar":"line.match(/https?:\\/\\/(?!(registry\\.npmjs\\.org|registry\\.yarnpkg\\.com))[a-zA-Z0-9.\\-/_]+/)","toVar":"httpMatch","file":"A:\\Package\\src\\lockfile.js","line":58},{"fromVar":"info.resolved || (info.version ? info.version : '')","toVar":"resolved","file":"A:\\Package\\src\\lockfile.js","line":74},{"fromVar":"LockfileAuditor","toVar":"module.exports","file":"A:\\Package\\src\\lockfile.js","line":99},{"fromVar":"[\r\n    {\r\n        id: 'ZFT-001',\r\n        alias: 'ENV_EXFILTRATION',\r\n        name: 'Environment Variable Exfiltration',\r\n        requires: ['ENV_READ', 'NETWORK_SINK'],\r\n        optional: ['OBFUSCATION'],\r\n        baseScore: 40,\r\n        description: 'Detection of environment variables being read and sent over the network.'\r\n    },\r\n    {\r\n        id: 'ZFT-002',\r\n        alias: 'SENSITIVE_FILE_EXFILTRATION',\r\n        name: 'Sensitive File Exfiltration',\r\n        requires: ['FILE_READ_SENSITIVE', 'NETWORK_SINK'],\r\n        baseScore: 50,\r\n        description: 'Detection of sensitive files (e.g., .ssh, .env) being read and sent over the network.'\r\n    },\r\n    {\r\n        id: 'ZFT-003',\r\n        alias: 'PERSISTENCE_ATTEMPT',\r\n        name: 'Persistence Attempt',\r\n        requires: ['FILE_WRITE_STARTUP'],\r\n        baseScore: 60,\r\n        description: 'Detection of attempts to write to system startup directories.'\r\n    },\r\n    {\r\n        id: 'ZFT-004',\r\n        alias: 'OBFUSCATED_EXECUTION',\r\n        name: 'Obfuscated Execution',\r\n        requires: ['OBFUSCATION', 'DYNAMIC_EXECUTION'],\r\n        baseScore: 40,\r\n        description: 'Detection of high-entropy strings being executed via eval or Function constructor.'\r\n    },\r\n    {\r\n        id: 'ZFT-005',\r\n        alias: 'SHELL_COMMAND_EXECUTION',\r\n        name: 'Shell Command Execution',\r\n        requires: ['SHELL_EXECUTION'],\r\n        optional: ['ENV_READ', 'FILE_READ_SENSITIVE'],\r\n        baseScore: 50,\r\n        description: 'Detection of shell command execution (child_process).'\r\n    },\r\n    {\r\n        id: 'ZFT-006',\r\n        alias: 'DYNAMIC_REQUIRE_DEPENDENCY',\r\n        name: 'Dynamic Require Dependency',\r\n        requires: ['DYNAMIC_EXECUTION'], // Will check if type === 'dynamic_require' in engine\r\n        baseScore: 30,\r\n        description: 'Detection of dynamic require calls where the dependency name is a variable.'\r\n    }\r\n]","toVar":"RULES","file":"A:\\Package\\src\\rules\\definitions.js","line":1},{"fromVar":"{\r\n    SOURCES: ['ENV_READ', 'FILE_READ_SENSITIVE'],\r\n    SINKS: ['NETWORK_SINK', 'DYNAMIC_EXECUTION', 'SHELL_EXECUTION'],\r\n    SIGNALS: ['OBFUSCATION', 'ENCODER_USE'],\r\n    PERSISTENCE: ['FILE_WRITE_STARTUP']\r\n}","toVar":"CATEGORIES","file":"A:\\Package\\src\\rules\\definitions.js","line":54},{"fromVar":"require('node:fs')","toVar":"fs","file":"A:\\Package\\src\\scanner.js","line":1},{"fromVar":"require('node:path')","toVar":"path","file":"A:\\Package\\src\\scanner.js","line":2},{"fromVar":"require('./collector')","toVar":"ASTCollector","file":"A:\\Package\\src\\scanner.js","line":3},{"fromVar":"require('./lifecycle')","toVar":"LifecycleResolver","file":"A:\\Package\\src\\scanner.js","line":4},{"fromVar":"require('./engine')","toVar":"SafetyEngine","file":"A:\\Package\\src\\scanner.js","line":5},{"fromVar":"await this.getFiles()","toVar":"files","file":"A:\\Package\\src\\scanner.js","line":18},{"fromVar":"scripts","toVar":"this.detectedLifecycleScripts","file":"A:\\Package\\src\\scanner.js","line":19},{"fromVar":"path.join(this.packageDir, 'node_modules', '.zift-cache')","toVar":"cacheDir","file":"A:\\Package\\src\\scanner.js","line":22},{"fromVar":"{\r\n            facts: {\r\n                ENV_READ: [],\r\n                FILE_READ_SENSITIVE: [],\r\n                NETWORK_SINK: [],\r\n                DYNAMIC_EXECUTION: [],\r\n                OBFUSCATION: [],\r\n                FILE_WRITE_STARTUP: [],\r\n                SHELL_EXECUTION: [],\r\n                ENCODER_USE: []\r\n            },\r\n            flows: []\r\n        }","toVar":"allFacts","file":"A:\\Package\\src\\scanner.js","line":27},{"fromVar":"8","toVar":"concurrency","file":"A:\\Package\\src\\scanner.js","line":42},{"fromVar":"0","toVar":"i","file":"A:\\Package\\src\\scanner.js","line":43},{"fromVar":"files.slice(i, i + concurrency)","toVar":"chunk","file":"A:\\Package\\src\\scanner.js","line":44},{"fromVar":"fs.statSync(file)","toVar":"stats","file":"A:\\Package\\src\\scanner.js","line":46},{"fromVar":"fs.readFileSync(file, 'utf8')","toVar":"code","file":"A:\\Package\\src\\scanner.js","line":49},{"fromVar":"require('../package.json').version","toVar":"pkgVersion","file":"A:\\Package\\src\\scanner.js","line":50},{"fromVar":"getHash(code + pkgVersion)","toVar":"fileHash","file":"A:\\Package\\src\\scanner.js","line":51},{"fromVar":"path.join(cacheDir, fileHash + '.json')","toVar":"cachePath","file":"A:\\Package\\src\\scanner.js","line":52},{"fromVar":"JSON.parse(fs.readFileSync(cachePath, 'utf8'))","toVar":"cached","file":"A:\\Package\\src\\scanner.js","line":59},{"fromVar":"this.collector.collect(code, file)","toVar":"result","file":"A:\\Package\\src\\scanner.js","line":64},{"fromVar":"this.collector.collect(code, file)","toVar":"result","file":"A:\\Package\\src\\scanner.js","line":70},{"fromVar":"this.engine.evaluate(allFacts, lifecycleFiles)","toVar":"findings","file":"A:\\Package\\src\\scanner.js","line":89},{"fromVar":"path.join(this.packageDir, '.ziftignore')","toVar":"ziftIgnorePath","file":"A:\\Package\\src\\scanner.js","line":95},{"fromVar":"['node_modules', '.git', 'dist', 'build', 'coverage', 'test', 'tests']","toVar":"ignoreLines","file":"A:\\Package\\src\\scanner.js","line":96},{"fromVar":"fs.readFileSync(ziftIgnorePath, 'utf8')","toVar":"content","file":"A:\\Package\\src\\scanner.js","line":98},{"fromVar":"[]","toVar":"results","file":"A:\\Package\\src\\scanner.js","line":103},{"fromVar":"fs.readdirSync(dir)","toVar":"list","file":"A:\\Package\\src\\scanner.js","line":104},{"fromVar":"path.join(dir, file)","toVar":"fullPath","file":"A:\\Package\\src\\scanner.js","line":106},{"fromVar":"path.relative(this.packageDir, fullPath)","toVar":"relativePath","file":"A:\\Package\\src\\scanner.js","line":107},{"fromVar":"fs.statSync(fullPath)","toVar":"stat","file":"A:\\Package\\src\\scanner.js","line":113},{"fromVar":"fullPath","toVar":"getJsFiles:dir","file":"A:\\Package\\src\\scanner.js","line":115},{"fromVar":"(dir) => {\r\n            const results = [];\r\n            const list = fs.readdirSync(dir);\r\n            for (const file of list) {\r\n                const fullPath = path.join(dir, file);\r\n                const relativePath = path.relative(this.packageDir, fullPath);\r\n\r\n                // Simple ignore check\r\n                if (ignoreLines.some(pattern => relativePath.includes(pattern) || file === pattern)) continue;\r\n                if (file.startsWith('.') && file !== '.ziftignore') continue;\r\n\r\n                const stat = fs.statSync(fullPath);\r\n                if (stat && stat.isDirectory()) {\r\n                    results.push(...getJsFiles(fullPath));\r\n                } else if (file.endsWith('.js')) {\r\n                    results.push(fullPath);\r\n                }\r\n            }\r\n            return results;\r\n        }","toVar":"getJsFiles","file":"A:\\Package\\src\\scanner.js","line":102},{"fromVar":"this.packageDir","toVar":"getJsFiles:dir","file":"A:\\Package\\src\\scanner.js","line":122},{"fromVar":"findings.sort((a, b) => b.score - a.score)","toVar":"sorted","file":"A:\\Package\\src\\scanner.js","line":126},{"fromVar":"'Low'","toVar":"classification","file":"A:\\Package\\src\\scanner.js","line":130},{"fromVar":"PackageScanner","toVar":"module.exports","file":"A:\\Package\\src\\scanner.js","line":151}]}